+++
title = "åˆ†ç‰‡åˆ©å™¨ AutoTableï¼šä¸ºç”¨æˆ·å¸¦æ¥ã€Œç®¡å®¶å¼ã€åˆ†ç‰‡é…ç½®ä½“éªŒ"
weight = 22
chapter = true
+++

åœ¨[ã€ŠDistSQLï¼šåƒæ•°æ®åº“ä¸€æ ·ä½¿ç”¨ Apache ShardingSphereã€‹](https://mp.weixin.qq.com/s/fdCtxd_xYNll0_ZdAjDvCA)ä¸€æ–‡ä¸­ï¼ŒCommitter å­Ÿæµ©ç„¶ä¸ºå¤§å®¶ä»‹ç»äº† DistSQL çš„è®¾è®¡åˆè¡·å’Œè¯­æ³•ä½“ç³»ï¼Œå¹¶é€šè¿‡å®æˆ˜æ“ä½œ**å±•ç¤ºäº†ä¸€æ¡ SQL åˆ›å»ºåˆ†å¸ƒå¼æ•°æ®åº“è¡¨çš„å¼ºå¤§èƒ½åŠ›ï¼Œå±•ç°äº† Apache ShardingSphere åœ¨æ–°å½¢æ€ä¸‹çš„äº¤äº’ä½“éªŒã€‚**

åœ¨å‰æ–‡å‘å¸ƒåï¼Œå°åŠ©æ‰‹é™†ç»­æ”¶åˆ°çƒ­å¿ƒè¯»è€…çš„ç§ä¿¡ï¼Œè¯¢é—®ä½¿ç”¨ DistSQL é…ç½®åˆ†ç‰‡è§„åˆ™çš„ç»†èŠ‚ï¼Œä»¥åŠä½¿ç”¨ YAMLã€Namespace ç­‰å½¢å¼çš„é…ç½®æ—¶ï¼Œæ˜¯å¦å¯ä»¥åƒ DistSQL ä¸€æ ·å¿«é€Ÿæ–¹ä¾¿çš„å®Œæˆåˆ†å¸ƒå¼è¡¨çš„é…ç½®å’Œåˆ›å»ºï¼Ÿæœ¬æ–‡å°†ä¸ºå¤§å®¶è§£ç­”è¿™äº›ç–‘é—®ã€‚

**æ±Ÿé¾™æ»”**

SphereEx ä¸­é—´ä»¶ç ”å‘å·¥ç¨‹å¸ˆï¼ŒApache ShardingSphere contributorã€‚ç›®å‰ä¸“æ³¨äº ShardingSphere æ•°æ®åº“ä¸­é—´ä»¶ç ”å‘åŠå¼€æºç¤¾åŒºå»ºè®¾ã€‚

## èƒŒæ™¯

**Sharding**æ˜¯ Apache ShardingSphere çš„æ ¸å¿ƒç‰¹æ€§ï¼Œä¹Ÿæ˜¯ ShardingSphere æœ€è¢«äººä»¬ç†ŸçŸ¥çš„ä¸€é¡¹èƒ½åŠ›ã€‚åœ¨è¿‡å»ï¼Œç”¨æˆ·è‹¥éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œä¸€ç§å…¸å‹çš„å®æ–½æµç¨‹ï¼ˆä¸å«æ•°æ®è¿ç§»ï¼‰å¦‚ä¸‹ï¼š

![](https://shardingsphere.apache.org/blog/img/Blog_22_img_4_Rewarded_User_Issue_Snapshot.png)

					å›¾1 Sharding å®æ–½æµç¨‹ç¤ºæ„å›¾

åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·éœ€è¦å‡†ç¡®çš„ç†è§£æ¯ä¸€å¼ æ•°æ®è¡¨çš„åˆ†ç‰‡ç­–ç•¥ã€æ˜ç¡®çš„çŸ¥æ™“æ¯å¼ è¡¨çš„å®é™…è¡¨åå’Œæ‰€åœ¨æ•°æ®åº“ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯æ¥é…ç½®åˆ†ç‰‡è§„åˆ™ã€‚

ä»¥ä¸Šè¿°åˆ†åº“åˆ†è¡¨åœºæ™¯ä¸ºä¾‹ï¼Œå®é™…çš„æ•°æ®è¡¨åˆ†å¸ƒæƒ…å†µå¯èƒ½å¦‚ä¸‹ï¼š

![](https://shardingsphere.apache.org/blog/img/Blog_22_img_2_8_Databases_4_Tables_Distribution.png)

					å›¾2 8 åº“ * 4 è¡¨åˆ†å¸ƒç¤ºæ„å›¾

## ç—›ç‚¹

åœ¨å‰è¿°çš„åˆ†åº“åˆ†è¡¨åœºæ™¯ä¸­ï¼Œä½œä¸º **Sharding** åŠŸèƒ½çš„ç”¨æˆ·ï¼Œå¿…é¡»è¦å¯¹æ•°æ®è¡¨çš„åˆ†å¸ƒæƒ…å†µäº†ç„¶äºå¿ƒï¼Œæ‰èƒ½å†™å‡ºæ­£ç¡®çš„ **actualDataNodes** è§„åˆ™ã€‚å¦‚ä¸Šè¿° t_order è¡¨å¯¹åº”çš„åˆ†ç‰‡é…ç½®å¦‚ä¸‹ï¼š

~~~
tables:
  t_order:
    actualDataNodes: ds_${0..7}.t_order_${0..3}
    databaseStrategy: 
      standard:
        shardingColumn: order_id
        shardingAlgorithmName: database_inline
    tableStrategy: 
      standard:
        shardingColumn: order_id
        shardingAlgorithmName: table_inline
shardingAlgorithms:
  database_inline:
    type: INLINE
    props:
      algorithm-expression: ds_${order_id % 8}
  table_inline:
    type: INLINE
    props:
      algorithm-expression: t_order_${order_id % 4}
~~~
å°½ç®¡ ShardingSphere çš„é…ç½®è§„åˆ™å·²ç»éå¸¸çš„è§„èŒƒå’Œç®€æ´ï¼Œä½†ä»æœ‰ç”¨æˆ·åœ¨ä½¿ç”¨ä¸­é‡åˆ°å„ç§éº»çƒ¦ï¼š

* ä¸ç†è§£åˆ†ç‰‡ç­–ç•¥æˆ–é…ç½®è§„åˆ™ï¼Œæ— ä»ä¸‹æ‰‹

* åˆ†ç‰‡é…ç½®ä¸æ•°æ®è¡¨å®é™…åˆ†å¸ƒä¸åŒ¹é…

* é…ç½®è¡¨è¾¾å¼æ ¼å¼ä¸æ­£ç¡®

* ç­‰ç­‰

å¦‚è¿™ä½ç”¨æˆ·æå‡ºçš„ issueï¼š

![](https://shardingsphere.apache.org/blog/img/Blog_22_img_3_Question_Comment.png)

## AutoTable æ¨ªç©ºå‡ºä¸–

ä¸ºäº†å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„ä½¿ç”¨åˆ†ç‰‡åŠŸèƒ½ï¼Œé™ä½é…ç½®å¤æ‚åº¦å’Œæå‡ä½¿ç”¨ä½“éªŒï¼ŒApache ShardingSphere 5.0.0 ç‰ˆæœ¬æ¨å‡ºäº†ä¸€ç§æ–°çš„åˆ†ç‰‡é…ç½®æ–¹å¼ï¼š**AutoTableã€‚**

é¡¾åæ€ä¹‰ï¼Œ**AutoTable** ç±»å‹çš„æ•°æ®è¡¨ï¼Œ**äº¤ç”± ShardingSphere è‡ªåŠ¨ç®¡ç†åˆ†ç‰‡ï¼Œç”¨æˆ·åªéœ€è¦æŒ‡å®šåˆ†ç‰‡æ•°é‡å’Œä½¿ç”¨çš„æ•°æ®æºï¼Œæ— éœ€å†å…³å¿ƒè¡¨çš„å…·ä½“åˆ†å¸ƒ**ï¼Œé…ç½®æ ¼å¼å¦‚ä¸‹ï¼š

~~~
autoTables:
  t_order:
    # æŒ‡å®šä½¿ç”¨çš„æ•°æ®æº
    actualDataSources: ds_${0..7}
    shardingStrategy:
      standard:
        shardingColumn: order_id
        shardingAlgorithmName: mod
shardingAlgorithms:
  mod:
    type: MOD
    props:
      # æŒ‡å®šåˆ†ç‰‡æ•°é‡
      sharding-count: 32
~~~

é€šè¿‡ä»¥ä¸Šé…ç½®ï¼ŒShardingSphere è¯†åˆ«å‡ºé€»è¾‘è¡¨ `t_order` éœ€è¦åˆ†ä¸º 32 ç‰‡ä¸”ä½¿ç”¨ 8 ä¸ªæ•°æ®æºï¼Œåˆ™è‡ªåŠ¨è®¡ç®—å‡º **8 åº“ * 4è¡¨** çš„åˆ†å¸ƒå…³ç³»ï¼Œå®ç°å’Œä¼ ç»Ÿæ–¹å¼ç­‰æ•ˆçš„é…ç½®ç»“æœã€‚

## ä¸ DistSQL ç»“åˆ

é€šè¿‡å‰ä¸€èŠ‚çš„é…ç½®å¯¹æ¯”ï¼Œç›¸ä¿¡è¯»è€…å·²ç»æ„Ÿå—åˆ°äº† **AutoTable** å¸¦æ¥çš„å˜é©ã€‚ä¸è¿‡ï¼Œéšç€ DistSQL çš„å…¬å¼€ï¼ŒShardingSphere è¿˜èƒ½å¸¦ç»™æˆ‘ä»¬æ›´å¤šã€‚

åœ¨ä½¿ç”¨ DistSQL è¿›è¡Œæ•°æ®ç®¡ç†çš„åœºæ™¯ä¸‹ï¼Œ**AutoTable** èƒ½å¤Ÿæå¤§çš„é™ä½åˆ†ç‰‡é…ç½®å¤æ‚åº¦ã€‚å¹¶ä¸”ï¼Œä¸ä¼ ç»Ÿæ–‡ä»¶é…ç½®å½¢å¼ç›¸æ¯”ï¼Œé€šè¿‡ DistSQL æ¥é…ç½®åˆ†ç‰‡è§„åˆ™æ˜¯å³æ—¶ç”Ÿæ•ˆçš„ï¼Œ**æ— éœ€é‡å¯**ï¼Œè¿™æ ·ä¹Ÿå°±å®Œå…¨ä¸ç”¨æ‹…å¿ƒå•å¼ è¡¨çš„è§„åˆ™è°ƒæ•´å½±å“å…¶ä»–åœ¨çº¿ä¸šåŠ¡ã€‚

é™¤äº†æ–°å¢åˆ†ç‰‡é…ç½®ï¼ŒDistSQL ä¹Ÿæä¾›äº†ä¿®æ”¹å’Œåˆ é™¤åˆ†ç‰‡è§„åˆ™çš„è¯­æ³•ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

~~~
# æ–°å¢åˆ†ç‰‡è§„åˆ™
CREATE SHARDING TABLE RULE t_order (
RESOURCES(resource_0,resource_1),
SHARDING_COLUMN=order_id,TYPE(NAME=hash_mod,PROPERTIES("sharding-count"=4))
);
# ä¿®æ”¹åˆ†ç‰‡è§„åˆ™
ALTER SHARDING TABLE RULE t_order (
RESOURCES(resource_0,resource_1),
SHARDING_COLUMN=order_id,TYPE(NAME=hash_mod,PROPERTIES("sharding-count"=10))
);
# ç§»é™¤åˆ†ç‰‡è§„åˆ™
DROP SHARDING TABLE RULE t_order;
~~~

**æ³¨ï¼š**è‹¥è§„åˆ™ä¿®æ”¹å½±å“åˆ°å­˜é‡æ•°æ®ï¼ŒShardingSphere è¿˜å°†æä¾›â€œå¼¹æ€§æ‰©ç¼©å®¹â€çš„åŠŸèƒ½ç”¨ä½œæ•°æ®è¿ç§»ï¼Œå¸®åŠ©ç”¨æˆ·æ–¹ä¾¿å¿«æ·çš„ç®¡ç†åˆ†å¸ƒå¼æ•°æ®ã€‚æœ‰å…³â€œå¼¹æ€§æ‰©ç¼©å®¹â€çš„å…·ä½“ç»†èŠ‚ï¼Œè¯·å…³æ³¨åç»­æ¨é€ã€‚

### FAQ

**Q1:**
ShardingSphere-JDBC ä¸­å¯ä»¥ä½¿ç”¨ AutoTable åˆ†ç‰‡é…ç½®å—ï¼Ÿ

å¯ä»¥ã€‚AutoTable åˆ†ç‰‡é…ç½®æ–¹å¼é€‚ç”¨äº ShardingSphere-JDBC å’Œ ShardingSphere-Proxyï¼Œåœ¨ Proxy ä¸­æ›´å¯ä»¥é€šè¿‡ DistSQL è¿›è¡ŒåŠ¨æ€é…ç½®ï¼Œæ»¡è¶³å„ç§æ¥å…¥æ–¹å¼çš„éœ€è¦ã€‚

**Q2:**
AutoTable æ”¯æŒå“ªäº›åˆ†ç‰‡ç®—æ³•ï¼Ÿ

AutoTable æ”¯æŒå…¨éƒ¨çš„è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•ï¼ŒåŒ…æ‹¬ï¼š

* MODï¼šå–æ¨¡åˆ†ç‰‡ç®—æ³•

* HASH_MODï¼šå“ˆå¸Œå–æ¨¡åˆ†ç‰‡ç®—æ³•

* VOLUME_RANGEï¼šåŸºäºåˆ†ç‰‡å®¹é‡çš„èŒƒå›´åˆ†ç‰‡ç®—æ³•

* BOUNDARY_RANGEï¼šåŸºäºåˆ†ç‰‡è¾¹ç•Œçš„èŒƒå›´åˆ†ç‰‡ç®—æ³•

* AUTO_INTERVALï¼šè‡ªåŠ¨æ—¶é—´æ®µåˆ†ç‰‡ç®—æ³•

å…³äºä»¥ä¸Šç®—æ³•çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯» **Apache ShardingSphere å®˜æ–¹æ–‡æ¡£-è‡ªåŠ¨åˆ†ç‰‡ç®—æ³•ï¼š**
https://shardingsphere.apache.org/document/current/cn/user-manual/common-config/builtin-algorithm/sharding/

é™¤å†…ç½®ç®—æ³•å¤–ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ SPI æ‰©å±•çš„æ–¹å¼åŠ è½½è‡ªå®šä¹‰çš„åˆ†ç‰‡ç®—æ³•ï¼Œæ»¡è¶³æ›´åŠ å®šåˆ¶åŒ–çš„åˆ†ç‰‡éœ€æ±‚ã€‚

**Q3:**
ä¸šåŠ¡å·²ç»ä½¿ç”¨äº† YAML é…ç½®åˆ†ç‰‡è§„åˆ™ï¼Œå¯ä»¥è½¬æ¢ä¸º AutoTable é…ç½®å½¢å¼å—ï¼Ÿ

ä¸æ¨èã€‚å¦‚æœæ˜¯å·²ç»å­˜åœ¨åˆ†ç‰‡è§„åˆ™çš„æ•°æ®è¡¨ï¼Œé™¤éèƒ½ç¡®å®šåˆ‡æ¢ä¸º AutoTable é…ç½®åï¼Œè¡¨åˆ†å¸ƒçŠ¶æ€ä¸é¢„æœŸå®Œå…¨ä¸€è‡´ï¼Œå¦åˆ™ä¸å»ºè®®å°è¯•åˆ‡æ¢å·²æœ‰é…ç½®ã€‚

ä¸è¿‡è‹¥æ˜¯åœ¨åŸæœ‰åº”ç”¨çš„åŸºç¡€ä¸Šæ–°å¢æ•°æ®è¡¨ï¼Œé‚£ä¹ˆæ–°å¢çš„è¡¨æ˜¯å¯ä»¥ä½¿ç”¨ AutoTable é…ç½®çš„ã€‚

**Q4:**
AutoTable çš„æ¨èä½¿ç”¨åœºæ™¯ï¼Ÿ

æ— è®ºæ˜¯åœ¨ ShardingSphere-JDBC è¿˜æ˜¯ ShardingSphere-Proxy ä¸­ï¼ŒAutoTable éƒ½å¸Œæœ›ä¸ºç”¨æˆ·å¸¦æ¥ã€Œç®¡å®¶å¼ã€çš„åˆ†ç‰‡é…ç½®ä½“éªŒã€‚å³ç”¨æˆ·åªå‘Šè¯‰ ShardingSphere åˆ†ç‰‡æ•°é‡ï¼Œä¸éœ€è¦å…³å¿ƒå®é™…è¡¨åœ¨å“ªä¸ªåº“ã€å“ªä¸ªåº“æœ‰å‡ å¼ è¡¨ç­‰é—®é¢˜ã€‚

å› æ­¤ï¼Œè‹¥è¦ä½¿ç”¨ AutoTable é…ç½®ï¼Œæ¨èç”¨æˆ·å¿˜å´ã€Œå…ˆå»ºè¡¨ã€å†é…è§„åˆ™ã€çš„ä¼ ç»Ÿæ€ç»´ï¼Œæ”¹ä¸ºå…ˆé…ç½®è§„åˆ™å†é€šè¿‡ **CREATE TABLE** è¯­å¥åˆ›å»ºæ•°æ®è¡¨ã€‚æŠŠ ShardingSphere çœ‹ä½œåˆ†å¸ƒå¼æ•°æ®åº“çš„æ¥å…¥ç‚¹ï¼Œè€Œä¸æ˜¯ä¸­é—´ä»¶ã€‚

**Q5:**
æ•°æ®æºåç§°ä¸æ˜¯è¿ç»­çš„ï¼Œæˆ–æ•°é‡å¤ªå¤šï¼Œå¯ä»¥ä½¿ç”¨ AutoTable å—ï¼Ÿ

å¯ä»¥ã€‚æŒ‡å®šæ•°æ®æºæ—¶å¹¶ä¸è¦æ±‚åç§°è¿ç»­ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨æšä¸¾å’Œ INLINE è¡¨è¾¾å¼ï¼Œå¦‚ä»¥ä¸‹å½¢å¼ï¼š

~~~
CREATE SHARDING TABLE RULE t_order (
RESOURCES('resource_${0..9}',resource_12,resource_15,"resource_$->{17..19}"),
...
);
~~~

**Q6:**
AutoTable é…ç½®å’Œä¼ ç»Ÿçš„åˆ†ç‰‡é…ç½®å¯ä»¥æ··åˆä½¿ç”¨å—ï¼Ÿ

å¯ä»¥ã€‚è¯·å‚è€ƒå®Œæ•´çš„é…ç½®æ ·ä¾‹ï¼š
https://github.com/apache/shardingsphere/blob/master/shardingsphere-jdbc/shardingsphere-jdbc-core/src/test/resources/config/config-sharding.yaml


### å½©è›‹

GitHub ID ä¸º @CatYangWei çš„ç”¨æˆ·ç¬¬ä¸€ä¸ªå‘ç°å¹¶æå‡ºäº†å…³äº AutoTable ç›¸å…³çš„é—®é¢˜ï¼š

å›¾5![]()

æ„Ÿè°¢è¿™ä½ç»†å¿ƒçš„ç”¨æˆ·ï¼Œæˆ‘ä»¬å°†ä¼šé€šè¿‡ GitHub ä¸æ‚¨è”ç³»ï¼Œå¹¶é€ä¸Šç¤¾åŒºçš„ç²¾ç¾å‘¨è¾¹ã€‚ğŸ‘ğŸ‘ğŸ‘ä¹Ÿæ¬¢è¿æ›´å¤šçš„ç¤¾åŒºå°ä¼™ä¼´å‘æˆ‘ä»¬æå‡ºä¼˜åŒ–å»ºè®®ï¼Œå¸®åŠ©ç¤¾åŒºæ›´å¥½åœ°æˆé•¿ï½

## ç»“è¯­

ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡åˆ†äº«çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚æœè¯»è€…å¯¹ Apache ShardingSphere æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨ GitHub issue åˆ—è¡¨æå‡ºï¼Œä¹Ÿå¯æäº¤ Pull Request å‚ä¸åˆ°å¼€æºç¤¾åŒºï¼Œä¸ºç¤¾åŒºè´¡çŒ®åŠ›é‡ã€‚

**GitHub issueï¼š**

https://github.com/apache/shardingsphere/issues

**è´¡çŒ®æŒ‡å—ï¼š**

https://shardingsphere.apache.org/community/cn/contribute/
