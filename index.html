<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Sharding-JDBC</title>
    
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    
    
    <link href="http://dangdangdotcom.github.io/sharding-jdbc/css/landing-page.css" rel="stylesheet">
    
    
    
    
    <style>
    .navbar {
    border-color: #e7e7e7;
}

.content-section-a,
footer,
.navbar {
    background-color: #f8f8f8;
    color: #333;
}

.navbar a:link,
.navbar-default .navbar-nav>li>a {
    color: #777;
}

.navbar a:hover,
.navbar-default .navbar-nav>li>a:hover {
    color: rgb(51, 51, 51);
}

.content-section-b {
    background-color: white;
    color: #333;
}

body {
    color: rgb(51, 51, 51);
}

.header-container h1,
.header-container h2,
.header-container h3,
.header-container h4 {
    color: rgb(51, 51, 51);
}

  </style>
    <link href="//cdn.bootcss.com/prism/1.4.1/themes/prism.min.css" rel="stylesheet">
    <link href="http://dangdangdotcom.github.io/sharding-jdbc/css/table.css" rel="stylesheet">
</head>
<body>


<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="page-scroll navbar-brand" href="#intro">Sharding-JDBC</a>
        </div>
        
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="page-scroll" href=https://github.com/dangdangdotcom/sharding-jdbc>Github</a>
                </li>
                <li>
                    <a class="page-scroll" href=http://dangdangdotcom.github.io/sharding-jdbc>Docs</a>
                </li>
                <li>
                    <a class="page-scroll" href=https://github.com/dangdangdotcom>DangDang</a>
                </li>
            </ul>
        </div>
        
    </div>
    
</nav>

<section id="intro">
    
    <div class="intro-header">
        <div class="container header-container">
            <div class="row">
                <div class="intro-image col-md-4"></div>
                <div class="intro-message col-md-6">
                    <h1>Sharding-JDBC</h1>
                    <h3>A JDBC driver for shard databases and tables</h3>
                    
                    
                    
                    <iframe class="github-btn" src="https://ghbtns.com/github-btn.html?user=dangdangdotcom&repo=Sharding-JDBC&type=star&count=true&size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
                    
                    <hr class="intro-divider">
                </div>
            </div>
        </div>
        
    </div>
    
</section>

<section id="services">


 
        <div class="container">
            <div class="row">
                <div>
                    <div class="clearfix"></div>
                    

<h1 id="主要贡献者:d680e8a854a7cbad6d490c445cba2eba">主要贡献者</h1>

<ul>
<li>张亮 &nbsp;&nbsp;&nbsp;<a href="http://www.dangdang.com/">当当</a> zhangliang@dangdang.com</li>
<li>高洪涛 <a href="http://www.dangdang.com/">当当</a> gaohongtao@dangdang.com</li>
<li>曹昊 &nbsp;&nbsp;&nbsp;<a href="http://www.dangdang.com/">当当</a> caohao@dangdang.com</li>
<li>岳令 &nbsp;&nbsp;&nbsp;<a href="http://www.dangdang.com/">当当</a> yueling@dangdang.com</li>
</ul>

<p><strong>讨论QQ群：</strong>532576663（不限于Sharding-JDBC，包括分布式，数据库相关以及其他互联网技术交流。由于QQ群已接近饱和，我们希望您在申请加群之前仔细阅读文档，并在加群申请中正确回答问题，以及在申请时写上您的姓名和公司名称。并且在入群后及时修改群名片。否则我们将有权拒绝您的入群申请。谢谢合作。）</p>

<h1 id="简介:d680e8a854a7cbad6d490c445cba2eba">简介</h1>

<p><code>Sharding-JDBC</code>直接封装<code>JDBC API</code>，可以理解为增强版的<code>JDBC</code>驱动，旧代码迁移成本几乎为零：</p>

<ul>
<li>可适用于任何基于<code>java</code>的<code>ORM</code>框架，如：<code>JPA</code>, <code>Hibernate</code>, <code>Mybatis</code>, <code>Spring JDBC Template</code>或直接使用<code>JDBC</code>。</li>
<li>可基于任何第三方的数据库连接池，如：<code>DBCP</code>, <code>C3P0</code>, <code>BoneCP</code>, <code>Druid</code>等。</li>
<li>理论上可支持任意实现<code>JDBC</code>规范的数据库。虽然目前仅支持<code>MySQL</code>，但已有支持<code>Oracle</code>，<code>SQLServer</code>，<code>DB2</code>等数据库的计划。</li>
</ul>

<p><code>Sharding-JDBC</code>定位为轻量级<code>java</code>框架，使用客户端直连数据库，以<code>jar</code>包形式提供服务，未使用中间层，无需额外部署，无其他依赖，<code>DBA</code>也无需改变原有的运维方式。<code>SQL</code>解析使用<code>Druid</code>解析器，是目前性能最高的<code>SQL</code>解析器。</p>

<p><code>Sharding-JDBC</code>功能灵活且全面：</p>

<ul>
<li>分片策略灵活，可支持<code>=</code>，<code>BETWEEN</code>，<code>IN</code>等多维度分片，也可支持多分片键共用。</li>
<li><code>SQL</code>解析功能完善，支持聚合，分组，排序，<code>Limit</code>，<code>OR</code>等查询，并且支持<code>Binding Table</code>以及笛卡尔积的表查询。</li>
<li>支持柔性事务(目前仅最大努力送达型)。</li>
<li>支持读写分离。</li>
</ul>

<p><code>Sharding-JDBC</code>配置多样：</p>

<ul>
<li>可支持YAML和Spring命名空间配置</li>
<li>灵活多样的<code>inline</code>方式</li>
</ul>

<hr />

<p>以下是常见的分库分表产品和<code>Sharding-JDBC</code>的对比：</p>

<table>
<thead>
<tr>
<th>功能</th>
<th align="center">Cobar</th>
<th align="right">Cobar-client</th>
<th align="right">TDDL</th>
<th align="right">Sharding-JDBC</th>
</tr>
</thead>

<tbody>
<tr>
<td>分库</td>
<td align="center">有</td>
<td align="right">有</td>
<td align="right">未开源</td>
<td align="right">有</td>
</tr>

<tr>
<td>分表</td>
<td align="center">无</td>
<td align="right">无</td>
<td align="right">未开源</td>
<td align="right">有</td>
</tr>

<tr>
<td>中间层</td>
<td align="center">是</td>
<td align="right">否</td>
<td align="right">否</td>
<td align="right">否</td>
</tr>

<tr>
<td>ORM支持</td>
<td align="center">任意</td>
<td align="right">仅MyBatis</td>
<td align="right">任意</td>
<td align="right">任意</td>
</tr>

<tr>
<td>数据库支持</td>
<td align="center">仅MySQL</td>
<td align="right">任意</td>
<td align="right">任意</td>
<td align="right">任意</td>
</tr>

<tr>
<td>异构语言</td>
<td align="center">可</td>
<td align="right">仅Java</td>
<td align="right">仅Java</td>
<td align="right">仅Java</td>
</tr>

<tr>
<td>外部依赖</td>
<td align="center">无</td>
<td align="right">无</td>
<td align="right">Diamond</td>
<td align="right">无</td>
</tr>
</tbody>
</table>

<hr />

<h1 id="整体架构图:d680e8a854a7cbad6d490c445cba2eba">整体架构图</h1>

<p><img src="img/architecture.png" alt="整体架构图1" /></p>

<h1 id="quick-start:d680e8a854a7cbad6d490c445cba2eba">Quick Start</h1>

<h2 id="引入maven依赖:d680e8a854a7cbad6d490c445cba2eba">引入maven依赖</h2>

<pre><code class="language-xml">&lt;!-- 引入sharding-jdbc核心模块 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.dangdang&lt;/groupId&gt;
    &lt;artifactId&gt;sharding-jdbc-core&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h2 id="规则配置:d680e8a854a7cbad6d490c445cba2eba">规则配置</h2>

<p><code>Sharding-JDBC</code>的分库分表通过规则配置描述，请简单浏览配置全貌：</p>

<pre><code class="language-java">ShardingRule shardingRule = ShardingRule.builder()
        .dataSourceRule(dataSourceRule)
        .tableRules(tableRuleList)
        .databaseShardingStrategy(new DatabaseShardingStrategy(&quot;sharding_column&quot;, new XXXShardingAlgorithm()))
        .tableShardingStrategy(new TableShardingStrategy(&quot;sharding_column&quot;, new XXXShardingAlgorithm())))
        .build();
</code></pre>

<p>规则配置包括数据源配置、表规则配置、分库策略和分表策略组成。这只是最简单的配置方式，实际使用可更加灵活，如：多分片键，分片策略直接和<code>tableRule</code>绑定等。</p>

<blockquote>
<p>详细的规则配置请参考<a href="post/user_guide">用户指南</a></p>
</blockquote>

<h2 id="使用基于shardingdatasource的jdbc接口:d680e8a854a7cbad6d490c445cba2eba">使用基于ShardingDataSource的JDBC接口</h2>

<p>通过<code>ShardingDataSourceFactory</code>工厂和规则配置对象获取<code>ShardingDataSource</code>，<code>ShardingDataSource</code>实现自<code>JDBC</code>的标准接口<code>DataSource</code>。然后可通过<code>DataSource</code>选择使用原生<code>JDBC</code>开发，或者使用<code>JPA</code>, <code>MyBatis</code>等<code>ORM</code>工具。
以<code>JDBC</code>原生实现为例：</p>

<pre><code class="language-java">DataSource dataSource = ShardingDataSourceFactory.createDataSource(shardingRule);
String sql = &quot;SELECT i.* FROM t_order o JOIN t_order_item i ON o.order_id=i.order_id WHERE o.user_id=? AND o.order_id=?&quot;;
try (
        Connection conn = dataSource.getConnection();
        PreparedStatement preparedStatement = conn.prepareStatement(sql)) {
    preparedStatement.setInt(1, 10);
    preparedStatement.setInt(2, 1001);
    try (ResultSet rs = preparedStatement.executeQuery()) {
        while(rs.next()) {
            System.out.println(rs.getInt(1));
            System.out.println(rs.getInt(2));
        }
    }
}
</code></pre>

<h2 id="使用spring命名空间配置:d680e8a854a7cbad6d490c445cba2eba">使用Spring命名空间配置</h2>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; 
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    xmlns:rdb=&quot;http://www.dangdang.com/schema/ddframe/rdb&quot; 
    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans 
                        http://www.springframework.org/schema/beans/spring-beans.xsd
                        http://www.springframework.org/schema/context 
                        http://www.springframework.org/schema/context/spring-context.xsd 
                        http://www.dangdang.com/schema/ddframe/rdb 
                        http://www.dangdang.com/schema/ddframe/rdb/rdb.xsd 
                        &quot;&gt;
    &lt;context:property-placeholder location=&quot;classpath:conf/rdb/conf.properties&quot; ignore-unresolvable=&quot;true&quot;/&gt;
    
    &lt;bean id=&quot;dbtbl_0&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/dbtbl_0&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;&quot;/&gt;
    &lt;/bean&gt;
    &lt;bean id=&quot;dbtbl_1&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/dbtbl_1&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;&quot;/&gt;
    &lt;/bean&gt;

    &lt;rdb:strategy id=&quot;orderTableStrategy&quot; sharding-columns=&quot;order_id&quot; algorithm-expression=&quot;t_order_${order_id.longValue() % 4}&quot;/&gt;
    &lt;rdb:strategy id=&quot;orderItemTableStrategy&quot; sharding-columns=&quot;order_id&quot; algorithm-expression=&quot;t_order_item_${order_id.longValue() % 4}&quot;/&gt;
    &lt;rdb:data-source id=&quot;shardingDataSource&quot;&gt;
        &lt;rdb:sharding-rule data-sources=&quot;dbtbl_0,dbtbl_1&quot;&gt;
            &lt;rdb:table-rules&gt;
                &lt;rdb:table-rule logic-table=&quot;t_order&quot; actual-tables=&quot;t_order_${0..3}&quot; table-strategy=&quot;orderTableStrategy&quot;/&gt;
                &lt;rdb:table-rule logic-table=&quot;t_order_item&quot; actual-tables=&quot;t_order_item_${0..3}&quot; table-strategy=&quot;orderItemTableStrategy&quot;/&gt;
            &lt;/rdb:table-rules&gt;
            &lt;rdb:default-database-strategy sharding-columns=&quot;user_id&quot; algorithm-expression=&quot;dbtbl_${user_id.longValue() % 2 + 1}&quot;/&gt;
        &lt;/rdb:sharding-rule&gt;
    &lt;/rdb:data-source&gt;
&lt;/beans&gt;
</code></pre>

                </div>
            </div>
        </div>
        


<div class="container">
    <div class="row">
        <div>
            <div class="clearfix"></div>
             <h2>相关文档</h2>
             <ul>
              
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/release_notes/" target="_blank">Release Notes</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/configuration/" target="_blank">Spring命名空间和Yaml配置</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/user_guide/" target="_blank">使用指南</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/features/" target="_blank">详细功能列表</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/concepts/" target="_blank">核心概念</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/architecture/" target="_blank">架构图</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/soft_transaction/" target="_blank">柔性事务</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/master_slave/" target="_blank">读写分离</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/directory_structure/" target="_blank">目录结构说明</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/limitations/" target="_blank">使用限制</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/sql_supported/" target="_blank">SQL支持详细列表</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/stress_test/" target="_blank">压力测试报告</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/roadmap/" target="_blank">未来线路规划</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/hint_sharding_value/" target="_blank">基于暗示(Hint)的分片键值注册方法</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/transaction/" target="_blank">事务支持说明</a></li>
             
                  <li> <a href="http://dangdangdotcom.github.io/sharding-jdbc/post/id-generator/" target="_blank">Id生成器</a></li>
             
             </ul>
        </div>
    </div>
</div>

</section>


<footer>
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <p class="copyright text-muted small">Copyright &copy; Sharding-JDBC All Rights Reserved</p>
            </div>
            <div class="col-md-4">
            </div>
        </div>
    </div>
</footer>

<script src="//cdn.bootcss.com/jquery/1.12.0/jquery.min.js"></script>


<script src="//cdn.bootcss.com/jquery-easing/1.3/jquery.easing.min.js"></script>


<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="//cdn.bootcss.com/prism/1.4.1/prism.min.js"></script>
<script src="//cdn.bootcss.com/prism/1.4.1//components/prism-java.min.js"></script>
<script src="//cdn.bootcss.com/prism/1.4.1//components/prism-sql.min.js"></script>
<script src="//cdn.bootcss.com/prism/1.4.1//components/prism-groovy.min.js"></script>
<script src="//cdn.bootcss.com/prism/1.4.1//components/prism-yaml.min.js"></script>


</body>
</html>

