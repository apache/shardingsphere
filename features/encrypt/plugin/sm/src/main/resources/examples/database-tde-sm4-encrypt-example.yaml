#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

######################################################################################################
# 
# TDE (Transparent Data Encryption) with SM4 FPE Algorithm Configuration Example
# 
# This example demonstrates how to configure TDE encryption using SM4-based Format Preserving Encryption (FPE).
# The algorithm preserves the original format of the data while providing encryption.
# 
######################################################################################################

databaseName: encrypt_db

dataSources:
  encrypt_ds:
    url: jdbc:mysql://127.0.0.1:3306/encrypt_db?serverTimezone=UTC&useSSL=false
    username: root
    password:
    connectionTimeoutMilliseconds: 30000
    idleTimeoutMilliseconds: 60000
    maxLifetimeMilliseconds: 1800000
    maxPoolSize: 50
    minPoolSize: 1

rules:
- !ENCRYPT
  tables:
    t_user:
      columns:
        # 纯数字字段（如手机号）- 使用数字字符集
        phone_number:
          cipher:
            name: phone_number_cipher
            encryptorName: tde_sm4_phone
        # 身份证号（数字+字母）- 使用数字+大写字母字符集
        id_card:
          cipher:
            name: id_card_cipher
            encryptorName: tde_sm4_idcard
        # 姓名（中文）- 使用中文字符集
        name:
          cipher:
            name: name_cipher
            encryptorName: tde_sm4_chinese
        # 邮箱（数字+字母+特殊字符）- 使用混合字符集
        email:
          cipher:
            name: email_cipher
            encryptorName: tde_sm4_mixed
  encryptors:
    # 手机号加密器 - 仅数字字符集
    tde_sm4_phone:
      type: SM4_FPE
      props:
        fpe-key-value: 'MySecretKey12345'
        fpe-number-mapper: '1'  # 1=数字字符集
    # 身份证号加密器 - 数字+大写字母字符集
    tde_sm4_idcard:
      type: SM4_FPE
      props:
        fpe-key-value: 'MySecretKey12345'
        fpe-number-mapper: '1,3'  # 1=数字, 3=大写字母
    # 中文姓名加密器 - 中文字符集
    tde_sm4_chinese:
      type: SM4_FPE
      props:
        fpe-key-value: 'MySecretKey12345'
        fpe-number-mapper: '4'  # 4=中文字符集
    # 邮箱加密器 - 混合字符集
    tde_sm4_mixed:
      type: SM4_FPE
      props:
        fpe-key-value: 'MySecretKey12345'
        fpe-number-mapper: '1,2,3,5'  # 1=数字, 2=小写字母, 3=大写字母, 5=特殊字符